"use strict";const h=require("electron"),y=require("path"),w=require("fs"),m=require("crypto");function i(e){const n=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const o in e)if(o!=="default"){const r=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(n,o,r.get?r:{enumerable:!0,get:()=>e[o]})}}return n.default=e,Object.freeze(n)}const g=i(h),c=i(y),t=i(w),_=i(m),{app:a,BrowserWindow:S,ipcMain:u,dialog:b}=g;let s=null;function j(e){const o=t.statSync(e).size;for(let r=0;r<3;r++){const l=_.randomBytes(o);t.writeFileSync(e,l),t.fsyncSync(t.openSync(e,"r+"))}t.unlinkSync(e)}function p(){try{s=new S({width:900,height:600,webPreferences:{nodeIntegration:!1,contextIsolation:!0,sandbox:!0,preload:c.join(__dirname,"preload.js")},autoHideMenuBar:!0})}catch(e){console.error("Window creation failed:",e);return}u.handle("secure-wipe",async()=>{try{if(!s)throw new Error("Window not available");const e=a.getPath("appData"),n=c.join(e,"escape-app");if(t.existsSync(n)){const l=t.readdirSync(n);for(const d of l){const f=c.join(n,d);j(f)}t.rmdirSync(n)}const o=a.getPath("logs"),r=c.join(o,"escape-app");return t.existsSync(r)&&t.rmSync(r,{recursive:!0}),{success:!0}}catch(e){return console.error("Wipe failed:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}),u.handle("show-biometric-dialog",async()=>{if(!s)return!1;const{response:e}=await b.showMessageBox(s,{type:"question",title:"Biometric Authentication",message:"Please authenticate using your device biometrics",buttons:["Cancel","Authenticate"],cancelId:0});return e===1}),process.env.NODE_ENV==="development"?s.loadURL("http://localhost:3000"):s.loadFile(c.join(__dirname,"../dist/index.html"))}a.whenReady().then(p);a.on("window-all-closed",()=>{s=null,process.platform!=="darwin"&&a.quit()});a.on("will-quit",()=>{});a.on("activate",()=>{s===null&&p()});
